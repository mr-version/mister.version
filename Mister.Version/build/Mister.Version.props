<?xml version="1.0" encoding="utf-8"?>
<Project xmlns="http://schemas.microsoft.com/developer/msbuild/2003">

  <!-- Import outer build version if it exists (written by buildMultiTargeting during Pack) -->
  <!-- This makes the version available during inner builds for dependency resolution -->
  <PropertyGroup>
    <_OuterBuildVersionPropsPath>$(MSBuildProjectDirectory)\obj\$(Configuration)\$(MSBuildProjectName).outerbuild.version.props</_OuterBuildVersionPropsPath>
  </PropertyGroup>
  <Import Project="$(_OuterBuildVersionPropsPath)" Condition="Exists('$(_OuterBuildVersionPropsPath)')" />

  <!-- Define properties -->
  <PropertyGroup>
    <AppSettingStronglyTyped_TFM Condition=" '$(MSBuildRuntimeType)' != 'Core' ">net472</AppSettingStronglyTyped_TFM>
    <AppSettingStronglyTyped_TFM Condition=" '$(MSBuildRuntimeType)' == 'Core' ">net8.0</AppSettingStronglyTyped_TFM>
    <!-- CRITICAL: Disable for test projects immediately -->
    <MonoRepoVersioningEnabled Condition="'$(IsTestProject)' == 'true'">false</MonoRepoVersioningEnabled>
    <MonoRepoVersioningEnabled Condition="'$(IsPackable)'=='false'">false</MonoRepoVersioningEnabled>
    <MonoRepoVersioningEnabled Condition="'$(MonoRepoVersioningEnabled)' == ''">true</MonoRepoVersioningEnabled>
    <MonoRepoRoot Condition="'$(MonoRepoRoot)' == ''">$(ProjectDir)</MonoRepoRoot>
    <MonoRepoTagPrefix Condition="'$(MonoRepoTagPrefix)' == ''">v</MonoRepoTagPrefix>
    <!-- Default to NOT updating project files to avoid requiring commits -->
    <MonoRepoUpdateProjectFile Condition="'$(MonoRepoUpdateProjectFile)' == ''">false</MonoRepoUpdateProjectFile>
    <!-- Enable debug mode for extra logging -->
    <MonoRepoDebug Condition="'$(MonoRepoDebug)' == ''">false</MonoRepoDebug>
    <!-- Enable extra debug mode for detailed dependency and commit info -->
    <MonoRepoExtraDebug Condition="'$(MonoRepoExtraDebug)' == ''">false</MonoRepoExtraDebug>
    <!-- Skip test projects by default -->
    <MonoRepoSkipTestProjects Condition="'$(MonoRepoSkipTestProjects)' == ''">true</MonoRepoSkipTestProjects>
    <!-- Skip non-packable projects by default -->
    <MonoRepoSkipNonPackableProjects Condition="'$(MonoRepoSkipNonPackableProjects)' == ''">true</MonoRepoSkipNonPackableProjects>
    <!-- Prerelease type for main/dev branches (none, alpha, beta, rc) -->
    <MonoRepoPrereleaseType Condition="'$(MonoRepoPrereleaseType)' == ''">none</MonoRepoPrereleaseType>
    <!-- Optional path to version configuration YAML file -->
    <MonoRepoConfigFile Condition="'$(MonoRepoConfigFile)' == ''"></MonoRepoConfigFile>
    <!-- Enable conventional commits analysis for semantic version bump detection -->
    <MonoRepoConventionalCommitsEnabled Condition="'$(MonoRepoConventionalCommitsEnabled)' == ''">false</MonoRepoConventionalCommitsEnabled>
    <!-- Commit patterns for major version bumps -->
    <MonoRepoMajorPatterns Condition="'$(MonoRepoMajorPatterns)' == ''">BREAKING CHANGE:;!:</MonoRepoMajorPatterns>
    <!-- Commit patterns for minor version bumps -->
    <MonoRepoMinorPatterns Condition="'$(MonoRepoMinorPatterns)' == ''">feat:;feature:</MonoRepoMinorPatterns>
    <!-- Commit patterns for patch version bumps -->
    <MonoRepoPatchPatterns Condition="'$(MonoRepoPatchPatterns)' == ''">fix:;bugfix:;perf:;refactor:</MonoRepoPatchPatterns>
    <!-- Commit patterns to ignore for versioning -->
    <MonoRepoIgnorePatterns Condition="'$(MonoRepoIgnorePatterns)' == ''">chore:;docs:;style:;test:;ci:</MonoRepoIgnorePatterns>
  </PropertyGroup>

  <PropertyGroup>
    <SanitizedProjectName>$(MSBuildProjectName.Replace(".", "_"))</SanitizedProjectName>
  </PropertyGroup>

  <!-- CRITICAL: Hook into NuGet's GetPackageVersion extension point -->
  <!-- This ensures our version calculation runs before NuGet queries project versions -->
  <PropertyGroup>
    <GetPackageVersionDependsOn>_MonoRepoSetVersion;$(GetPackageVersionDependsOn)</GetPackageVersionDependsOn>
  </PropertyGroup>

  <!-- Import early version calculation props if available -->
  <Import Project="$(IntermediateOutputPath)$(MSBuildProjectName).version.props"
          Condition="'$(MonoRepoVersioningEnabled)'=='true' and '$(IsPackable)' == 'true' and Exists('$(IntermediateOutputPath)$(MSBuildProjectName).version.props')" />

</Project>