<?xml version="1.0" encoding="utf-8"?>
<Project xmlns="http://schemas.microsoft.com/developer/msbuild/2003">

  <!-- Import outer build version if it exists (written by buildMultiTargeting during Pack) -->
  <!-- This makes the version available during inner builds for dependency resolution -->
  <PropertyGroup>
    <_OuterBuildVersionPropsPath>$(MSBuildProjectDirectory)\obj\$(Configuration)\$(MSBuildProjectName).outerbuild.version.props</_OuterBuildVersionPropsPath>
  </PropertyGroup>
  <Import Project="$(_OuterBuildVersionPropsPath)" Condition="Exists('$(_OuterBuildVersionPropsPath)')" />

  <!-- Define properties -->
  <PropertyGroup>
    <AppSettingStronglyTyped_TFM Condition=" '$(MSBuildRuntimeType)' != 'Core' ">net472</AppSettingStronglyTyped_TFM>
    <AppSettingStronglyTyped_TFM Condition=" '$(MSBuildRuntimeType)' == 'Core' ">net8.0</AppSettingStronglyTyped_TFM>
    <!-- CRITICAL: Disable for test projects immediately -->
    <MonoRepoVersioningEnabled Condition="'$(IsTestProject)' == 'true'">false</MonoRepoVersioningEnabled>
    <MonoRepoVersioningEnabled Condition="'$(IsPackable)'=='false'">false</MonoRepoVersioningEnabled>
    <MonoRepoVersioningEnabled Condition="'$(MonoRepoVersioningEnabled)' == ''">true</MonoRepoVersioningEnabled>
    <MonoRepoRoot Condition="'$(MonoRepoRoot)' == ''">$(ProjectDir)</MonoRepoRoot>
    <MonoRepoTagPrefix Condition="'$(MonoRepoTagPrefix)' == ''">v</MonoRepoTagPrefix>
    <!-- Default to NOT updating project files to avoid requiring commits -->
    <MonoRepoUpdateProjectFile Condition="'$(MonoRepoUpdateProjectFile)' == ''">false</MonoRepoUpdateProjectFile>
    <!-- Enable debug mode for extra logging -->
    <MonoRepoDebug Condition="'$(MonoRepoDebug)' == ''">false</MonoRepoDebug>
    <!-- Enable extra debug mode for detailed dependency and commit info -->
    <MonoRepoExtraDebug Condition="'$(MonoRepoExtraDebug)' == ''">false</MonoRepoExtraDebug>
    <!-- Skip test projects by default -->
    <MonoRepoSkipTestProjects Condition="'$(MonoRepoSkipTestProjects)' == ''">true</MonoRepoSkipTestProjects>
    <!-- Skip non-packable projects by default -->
    <MonoRepoSkipNonPackableProjects Condition="'$(MonoRepoSkipNonPackableProjects)' == ''">true</MonoRepoSkipNonPackableProjects>
    <!-- Prerelease type for main/dev branches (none, alpha, beta, rc) -->
    <MonoRepoPrereleaseType Condition="'$(MonoRepoPrereleaseType)' == ''">none</MonoRepoPrereleaseType>
    <!-- Optional path to version configuration YAML file -->
    <MonoRepoConfigFile Condition="'$(MonoRepoConfigFile)' == ''"></MonoRepoConfigFile>
    <!-- Enable conventional commits analysis for semantic version bump detection -->
    <MonoRepoConventionalCommitsEnabled Condition="'$(MonoRepoConventionalCommitsEnabled)' == ''">false</MonoRepoConventionalCommitsEnabled>
    <!-- Commit patterns for major version bumps -->
    <MonoRepoMajorPatterns Condition="'$(MonoRepoMajorPatterns)' == ''">BREAKING CHANGE:;!:</MonoRepoMajorPatterns>
    <!-- Commit patterns for minor version bumps -->
    <MonoRepoMinorPatterns Condition="'$(MonoRepoMinorPatterns)' == ''">feat:;feature:</MonoRepoMinorPatterns>
    <!-- Commit patterns for patch version bumps -->
    <MonoRepoPatchPatterns Condition="'$(MonoRepoPatchPatterns)' == ''">fix:;bugfix:;perf:;refactor:</MonoRepoPatchPatterns>
    <!-- Commit patterns to ignore for versioning -->
    <MonoRepoIgnorePatterns Condition="'$(MonoRepoIgnorePatterns)' == ''">chore:;docs:;style:;test:;ci:</MonoRepoIgnorePatterns>
    <!-- Enable file pattern-based change detection for smart versioning -->
    <MonoRepoChangeDetectionEnabled Condition="'$(MonoRepoChangeDetectionEnabled)' == ''">false</MonoRepoChangeDetectionEnabled>
    <!-- File patterns to ignore (won't trigger version bumps) -->
    <MonoRepoIgnoreFilePatterns Condition="'$(MonoRepoIgnoreFilePatterns)' == ''">**/*.md;**/docs/**;**/*.txt;**/.editorconfig;**/.gitignore</MonoRepoIgnoreFilePatterns>
    <!-- File patterns that require major version bumps -->
    <MonoRepoMajorFilePatterns Condition="'$(MonoRepoMajorFilePatterns)' == ''"></MonoRepoMajorFilePatterns>
    <!-- File patterns that require minor version bumps -->
    <MonoRepoMinorFilePatterns Condition="'$(MonoRepoMinorFilePatterns)' == ''"></MonoRepoMinorFilePatterns>
    <!-- File patterns that require patch version bumps -->
    <MonoRepoPatchFilePatterns Condition="'$(MonoRepoPatchFilePatterns)' == ''"></MonoRepoPatchFilePatterns>
    <!-- Source-only mode: only version when source code changes (ignore test/doc changes) -->
    <MonoRepoSourceOnlyMode Condition="'$(MonoRepoSourceOnlyMode)' == ''">false</MonoRepoSourceOnlyMode>
    <!-- Additional directories to monitor for changes (semicolon-separated paths) -->
    <MonoRepoAdditionalMonitorPaths Condition="'$(MonoRepoAdditionalMonitorPaths)' == ''"></MonoRepoAdditionalMonitorPaths>
    <!-- Enable automatic changelog generation during build -->
    <MonoRepoGenerateChangelog Condition="'$(MonoRepoGenerateChangelog)' == ''">false</MonoRepoGenerateChangelog>
    <!-- Changelog output format (markdown, text, json) -->
    <MonoRepoChangelogFormat Condition="'$(MonoRepoChangelogFormat)' == ''">markdown</MonoRepoChangelogFormat>
    <!-- Changelog output file path -->
    <MonoRepoChangelogOutputPath Condition="'$(MonoRepoChangelogOutputPath)' == ''">CHANGELOG.md</MonoRepoChangelogOutputPath>
    <!-- Repository URL for generating links in changelog -->
    <MonoRepoChangelogRepositoryUrl Condition="'$(MonoRepoChangelogRepositoryUrl)' == ''"></MonoRepoChangelogRepositoryUrl>
    <!-- Include commit authors in changelog -->
    <MonoRepoChangelogIncludeAuthors Condition="'$(MonoRepoChangelogIncludeAuthors)' == ''">false</MonoRepoChangelogIncludeAuthors>
    <!-- Enable shallow clone support for repos cloned with --depth -->
    <MonoRepoShallowCloneSupport Condition="'$(MonoRepoShallowCloneSupport)' == ''">true</MonoRepoShallowCloneSupport>
    <!-- Fallback version for shallow clones with limited history -->
    <MonoRepoShallowCloneFallbackVersion Condition="'$(MonoRepoShallowCloneFallbackVersion)' == ''"></MonoRepoShallowCloneFallbackVersion>
    <!-- Enable submodule change detection (tracks .gitmodules and submodule pointer changes) -->
    <MonoRepoSubmoduleSupport Condition="'$(MonoRepoSubmoduleSupport)' == ''">false</MonoRepoSubmoduleSupport>
    <!-- Custom tag patterns (semicolon-separated): ProjectName={name}-{prefix}{version} -->
    <MonoRepoCustomTagPatterns Condition="'$(MonoRepoCustomTagPatterns)' == ''"></MonoRepoCustomTagPatterns>
    <!-- Enable branch-based versioning strategies -->
    <MonoRepoBranchBasedVersioning Condition="'$(MonoRepoBranchBasedVersioning)' == ''">false</MonoRepoBranchBasedVersioning>
    <!-- Branch versioning rules (semicolon-separated): branchPattern=strategy -->
    <MonoRepoBranchVersioningRules Condition="'$(MonoRepoBranchVersioningRules)' == ''"></MonoRepoBranchVersioningRules>
    <!-- Include branch name in version build metadata for feature branches -->
    <MonoRepoIncludeBranchInMetadata Condition="'$(MonoRepoIncludeBranchInMetadata)' == ''">false</MonoRepoIncludeBranchInMetadata>
    <!-- Validate that version tags are reachable from current branch -->
    <MonoRepoValidateTagAncestry Condition="'$(MonoRepoValidateTagAncestry)' == ''">true</MonoRepoValidateTagAncestry>
    <!-- Fetch depth for shallow clone operations -->
    <MonoRepoFetchDepth Condition="'$(MonoRepoFetchDepth)' == ''">50</MonoRepoFetchDepth>
    <!-- Version scheme to use: semver or calver (default: semver) -->
    <MonoRepoVersionScheme Condition="'$(MonoRepoVersionScheme)' == ''">semver</MonoRepoVersionScheme>
    <!-- CalVer format: YYYY.MM.PATCH, YY.0M.PATCH, YYYY.WW.PATCH, YYYY.0M.PATCH -->
    <MonoRepoCalVerFormat Condition="'$(MonoRepoCalVerFormat)' == ''">YYYY.MM.PATCH</MonoRepoCalVerFormat>
    <!-- CalVer start date (optional): YYYY-MM-DD format -->
    <MonoRepoCalVerStartDate Condition="'$(MonoRepoCalVerStartDate)' == ''"></MonoRepoCalVerStartDate>
    <!-- Reset patch version periodically for CalVer (monthly/weekly) -->
    <MonoRepoCalVerResetPatch Condition="'$(MonoRepoCalVerResetPatch)' == ''">true</MonoRepoCalVerResetPatch>
    <!-- CalVer separator (default: .) -->
    <MonoRepoCalVerSeparator Condition="'$(MonoRepoCalVerSeparator)' == ''">.</MonoRepoCalVerSeparator>
  </PropertyGroup>

  <PropertyGroup>
    <SanitizedProjectName>$(MSBuildProjectName.Replace(".", "_"))</SanitizedProjectName>
  </PropertyGroup>

  <!-- CRITICAL: Hook into NuGet's GetPackageVersion extension point -->
  <!-- This ensures our version calculation runs before NuGet queries project versions -->
  <PropertyGroup>
    <GetPackageVersionDependsOn>_MonoRepoSetVersion;$(GetPackageVersionDependsOn)</GetPackageVersionDependsOn>
  </PropertyGroup>

  <!-- Import early version calculation props if available -->
  <Import Project="$(IntermediateOutputPath)$(MSBuildProjectName).version.props"
          Condition="'$(MonoRepoVersioningEnabled)'=='true' and '$(IsPackable)' == 'true' and Exists('$(IntermediateOutputPath)$(MSBuildProjectName).version.props')" />

</Project>